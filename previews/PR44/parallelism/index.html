<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Bottlenecks and performance tips · RandomFeatures.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="RandomFeatures.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">RandomFeatures.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../setting_up_scalar/">Scalar method</a></li><li><a class="tocitem" href="../setting_up_vector/">Vector method</a></li><li class="is-active"><a class="tocitem" href>Bottlenecks and performance tips</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Parallelism/memory"><span>Parallelism/memory</span></a></li></ul></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../API/Samplers/">Samplers</a></li><li><a class="tocitem" href="../API/Features/">Features</a></li><li><a class="tocitem" href="../API/Methods/">Methods</a></li><li><a class="tocitem" href="../API/Utilities/">Utilities</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Bottlenecks and performance tips</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Bottlenecks and performance tips</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/RandomFeatures.jl/blob/main/docs/src/parallelism.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Explicit-bottlenecks"><a class="docs-heading-anchor" href="#Explicit-bottlenecks">Explicit bottlenecks</a><a id="Explicit-bottlenecks-1"></a><a class="docs-heading-anchor-permalink" href="#Explicit-bottlenecks" title="Permalink"></a></h1><h3 id="Explicit-bottlenecks-2"><a class="docs-heading-anchor" href="#Explicit-bottlenecks-2">Explicit bottlenecks</a><a class="docs-heading-anchor-permalink" href="#Explicit-bottlenecks-2" title="Permalink"></a></h3><ul><li>By far the highest computational demand for high-dimensional and/or large data systems is the building of the system matrix, particularly the multiplication <span>$\Phi^T\Phi$</span> (for scalar) and <span>$\Phi_{n,i,m}\Phi_{n,j,m}$</span>. These can be accelerated by multithreading (see below)</li><li>For large number of features, the inversion <code>inv(factorization(system_matrix))</code> is noticeable, though typically still small when in the regime of <code>n_features &lt;&lt; n_samples * output_dim</code>.</li><li>For the vector case, the use of non-diagonal <span>$\Lambda_{i,j}$</span> for regularization cannot take advantage of certain matrix-tensor identities and may also cause substantial slow-down. (currently)</li><li>Prediction bottlenecks are largely due to allocations and matrix multiplications. Please see our <code>predict!()</code> methods which allow for users to pass in preallocated of arrays. This is very beneficial for repeated predictions.</li><li>For systems without enough regularization, positive definiteness may need to be enforced. If done too often, it has non-negligible cost, as it involves calculating eigenvalues of the non p.d. matrix (particularly <code>abs(min(eigval)</code>) that is then added to the diagonal. It is better to add more regularization into <span>$\Lambda$</span></li></ul><h3 id="Implicit-bottlenecks"><a class="docs-heading-anchor" href="#Implicit-bottlenecks">Implicit bottlenecks</a><a id="Implicit-bottlenecks-1"></a><a class="docs-heading-anchor-permalink" href="#Implicit-bottlenecks" title="Permalink"></a></h3><ul><li>The optimization of hyperparameters is a costly operation that may require construction and evaluation of thousands of <code>RandomFeatureMethod</code>s. The dimensionality (i.e. complexity) of this task will depend on how many free parameters are taken to be within a distribution though. <span>$\mathcal{O}(1000s)$</span> parameters may take several hours to optimize (on multiple threads).</li></ul><h1 id="Parallelism/memory"><a class="docs-heading-anchor" href="#Parallelism/memory">Parallelism/memory</a><a id="Parallelism/memory-1"></a><a class="docs-heading-anchor-permalink" href="#Parallelism/memory" title="Permalink"></a></h1><ul><li>We make use of <a href="https://github.com/mcabbott/Tullio.jl"><code>Tullio.jl</code></a> which comes with in-built memory management. We are phasing out our own batches in favour of using this for now.</li><li>[<code>Tullio.jl</code>(https://github.com/mcabbott/Tullio.jl) comes with multithreading routines, Simply call the code with <code>julia --project -t n_threads</code> to take advantage of this. Depending on problem size you may wish to use your own external threading, Tullio will greedily steal threads in this case. To prevent this interference we provide a keyword argument: </li></ul><pre><code class="language-julia hljs">RandomFeatureMethod(... ; tullio_threading=false) # serial threading during the build and fit! methods
predict(...; tullio_threading=false) # serial threading for prediction
predict!(...; tullio_threading=false) # serial threading for in-place prediction</code></pre><p>An example where <code>tullio_threading=false</code> is useful is when optimizing hyperparameters with ensemble methods (see our examples), here one could use threading/multiprocessing approaches across ensemble members to make better use of the embarassingly parallel framework (e.g. see this page for <a href="https://clima.github.io/EnsembleKalmanProcesses.jl/dev/parallel_hpc/">EnsembleKalmanProcessess: Parallelism and HPC</a>. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We do not yet have GPU functionality</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../setting_up_vector/">« Vector method</a><a class="docs-footer-nextpage" href="../contributing/">Contributing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Saturday 22 April 2023 20:46">Saturday 22 April 2023</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
